"# ๐๏ธ ูุฎุทุท ูุงุนุฏุฉ ุงูุจูุงูุงุช - Supermarket Database Schema

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุญุชูู ุนูู **14 ุฌุฏูู ุฑุฆูุณู** ูุตููุฉ ูุฅุฏุงุฑุฉ ุฌููุน ุฌูุงูุจ ุงูุณูุจุฑ ูุงุฑูุช.

---

## ๐ ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ

### 1. users - ุงููุณุชุฎุฏููู
ุฅุฏุงุฑุฉ ุญุณุงุจุงุช ุงููุณุชุฎุฏููู ูุงูุตูุงุญูุงุช

| Column | Type | Description |
|--------|------|-------------|
| id | String (UUID) | ุงููุนุฑู ุงููุฑูุฏ |
| username | String | ุงุณู ุงููุณุชุฎุฏู (ูุฑูุฏ) |
| email | String | ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ูุฑูุฏ) |
| hashed_password | String | ูููุฉ ุงููุฑูุฑ ุงููุดูุฑุฉ |
| full_name | String | ุงูุงุณู ุงููุงูู |
| role | Enum | ุงูุตูุงุญูุฉ (admin, manager, cashier) |
| is_active | Boolean | ุงูุญุณุงุจ ูุดุทุ |
| created_at | DateTime | ุชุงุฑูุฎ ุงูุฅูุดุงุก |
| updated_at | DateTime | ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ |

**ุงูุนูุงูุงุช:**
- ูู ุนุฏุฉ `invoices` (ููุงุชูุฑ)
- ูู ุนุฏุฉ `shifts` (ูุฑุฏูุงุช)
- ูู ุนุฏุฉ `audit_logs` (ุณุฌูุงุช ุชุฏููู)

---

### 2. categories - ุงูุชุตูููุงุช
ุชุตููู ุงูููุชุฌุงุช

| Column | Type | Description |
|--------|------|-------------|
| id | String (UUID) | ุงููุนุฑู ุงููุฑูุฏ |
| name | String | ุงุณู ุงูุชุตููู (ุนุฑุจู) |
| name_en | String | ุงุณู ุงูุชุตููู (ุฅูุฌููุฒู) |
| description | Text | ุงููุตู |
| is_active | Boolean | ูุดุทุ |
| created_at | DateTime | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

**ุงูุนูุงูุงุช:**
- ูู ุนุฏุฉ `products` (ููุชุฌุงุช)

---

### 3. products - ุงูููุชุฌุงุช
ูุนูููุงุช ุงูููุชุฌุงุช ูุงููุฎุฒูู

| Column | Type | Description |
|--------|------|-------------|
| id | String (UUID) | ุงููุนุฑู ุงููุฑูุฏ |
| barcode | String | ุงูุจุงุฑููุฏ (ูุฑูุฏ) |
| name | String | ุงุณู ุงูููุชุฌ (ุนุฑุจู) |
| name_en | String | ุงุณู ุงูููุชุฌ (ุฅูุฌููุฒู) |
| description | Text | ุงููุตู |
| category_id | String | ูุนุฑู ุงูุชุตููู |
| cost_price | Decimal(10,2) | ุณุนุฑ ุงูุชูููุฉ |
| selling_price | Decimal(10,2) | ุณุนุฑ ุงูุจูุน |
| stock_quantity | Integer | ุงููููุฉ ูู ุงููุฎุฒูู |
| min_stock_level | Integer | ุงูุญุฏ ุงูุฃุฏูู ูููุฎุฒูู |
| unit | String | ุงููุญุฏุฉ (piece, kg, liter, box) |
| tax_rate | Decimal(5,2) | ูุณุจุฉ ุงูุถุฑูุจุฉ (%) |
| image_url | String | ุฑุงุจุท ุงูุตูุฑุฉ |
| is_active | Boolean | ูุดุทุ |
| created_at | DateTime | ุชุงุฑูุฎ ุงูุฅูุดุงุก |
| updated_at | DateTime | ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ |

**ุงูุนูุงูุงุช:**
- ููุชูู ูู `category` (ุชุตููู)
- ูู ุนุฏุฉ `invoice_items` (ุนูุงุตุฑ ููุงุชูุฑ)
- ูู ุนุฏุฉ `inventory_movements` (ุญุฑูุงุช ูุฎุฒูู)

**ูุคุดุฑุงุช (Indexes):**
- `barcode` (ูุฑูุฏ)
- `name`
- `category_id`

---

### 4. product_bundles - ุฑุฒู ุงูููุชุฌุงุช
ุญุฒู ุงูููุชุฌุงุช (ุนุฑูุถ)

| Column | Type | Description |
|--------|------|-------------|
| id | String (UUID) | ุงููุนุฑู ุงููุฑูุฏ |
| name | String | ุงุณู ุงูุฑุฒูุฉ |
| barcode | String | ุงูุจุงุฑููุฏ (ูุฑูุฏ) |
| description | Text | ุงููุตู |
| bundle_price | Decimal(10,2) | ุณุนุฑ ุงูุฑุฒูุฉ |
| is_active | Boolean | ูุดุทุ |
| created_at | DateTime | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

**ุงูุนูุงูุงุช:**
- ูุญุชูู ุนูู ุนุฏุฉ `products` (many-to-many)

---

### 5. suppliers - ุงูููุฑุฏูู
ูุนูููุงุช ุงูููุฑุฏูู

| Column | Type | Description |
|--------|------|-------------|
| id | String (UUID) | ุงููุนุฑู ุงููุฑูุฏ |
| name | String | ุงุณู ุงูููุฑุฏ |
| contact_person | String | ุดุฎุต ุงูุงุชุตุงู |
| phone | String | ุฑูู ุงููุงุชู |
| email | String | ุงูุจุฑูุฏ ุงูุฅููุชุฑููู |
| address | Text | ุงูุนููุงู |
| is_active | Boolean | ูุดุทุ |
| created_at | DateTime | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

---

### 6. customers - ุงูุนููุงุก
ูุนูููุงุช ุงูุนููุงุก

| Column | Type | Description |
|--------|------|-------------|
| id | String (UUID) | ุงููุนุฑู ุงููุฑูุฏ |
| name | String | ุงุณู ุงูุนููู |
| phone | String | ุฑูู ุงููุงุชู (ูุฑูุฏ) |
| email | String | ุงูุจุฑูุฏ ุงูุฅููุชุฑููู |
| address | Text | ุงูุนููุงู |
| loyalty_points | Integer | ููุงุท ุงูููุงุก |
| is_active | Boolean | ูุดุทุ |
| created_at | DateTime | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

**ุงูุนูุงูุงุช:**
- ูู ุนุฏุฉ `invoices` (ููุงุชูุฑ)

**ูุคุดุฑุงุช:**
- `phone` (ูุฑูุฏ)
- `name`

---

### 7. invoices - ุงูููุงุชูุฑ
ููุงุชูุฑ ุงููุจูุนุงุช ูุงููุดุชุฑูุงุช

| Column | Type | Description |
|--------|------|-------------|
| id | String (UUID) | ุงููุนุฑู ุงููุฑูุฏ |
| invoice_number | String | ุฑูู ุงููุงุชูุฑุฉ (ูุฑูุฏ) |
| invoice_type | Enum | ุงูููุน (sale, purchase, return) |
| user_id | String | ูุนุฑู ุงููุณุชุฎุฏู |
| customer_id | String | ูุนุฑู ุงูุนููู |
| shift_id | String | ูุนุฑู ุงููุฑุฏูุฉ |
| subtotal | Decimal(10,2) | ุงูุฅุฌูุงูู ุงููุฑุนู |
| tax_amount | Decimal(10,2) | ูุจูุบ ุงูุถุฑูุจุฉ |
| discount_amount | Decimal(10,2) | ูุจูุบ ุงูุฎุตู |
| total_amount | Decimal(10,2) | ุงูุฅุฌูุงูู ุงูููุงุฆู |
| payment_method | Enum | ุทุฑููุฉ ุงูุฏูุน (cash, card, electronic, mixed) |
| paid_amount | Decimal(10,2) | ุงููุจูุบ ุงููุฏููุน |
| change_amount | Decimal(10,2) | ุงูุจุงูู |
| notes | Text | ููุงุญุธุงุช |
| is_void | Boolean | ููุบุงุฉุ |
| created_at | DateTime | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

**ุงูุนูุงูุงุช:**
- ููุชูู ูู `user` (ูุณุชุฎุฏู)
- ููุชูู ูู `customer` (ุนููู)
- ููุชูู ูู `shift` (ูุฑุฏูุฉ)
- ูู ุนุฏุฉ `invoice_items` (ุนูุงุตุฑ)
- ูู ุนุฏุฉ `payments` (ูุฏููุนุงุช)

**ูุคุดุฑุงุช:**
- `invoice_number` (ูุฑูุฏ)
- `created_at`
- `user_id`
- `customer_id`

---

### 8. invoice_items - ุนูุงุตุฑ ุงูููุงุชูุฑ
ุงูููุชุฌุงุช ูู ูู ูุงุชูุฑุฉ

| Column | Type | Description |
|--------|------|-------------|
| id | String (UUID) | ุงููุนุฑู ุงููุฑูุฏ |
| invoice_id | String | ูุนุฑู ุงููุงุชูุฑุฉ |
| product_id | String | ูุนุฑู ุงูููุชุฌ |
| product_name | String | ุงุณู ุงูููุชุฌ |
| quantity | Decimal(10,3) | ุงููููุฉ |
| unit_price | Decimal(10,2) | ุณุนุฑ ุงููุญุฏุฉ |
| tax_rate | Decimal(5,2) | ูุณุจุฉ ุงูุถุฑูุจุฉ |
| discount | Decimal(10,2) | ุงูุฎุตู |
| total_price | Decimal(10,2) | ุงูุณุนุฑ ุงูุฅุฌูุงูู |

**ุงูุนูุงูุงุช:**
- ููุชูู ูู `invoice` (ูุงุชูุฑุฉ)
- ููุชูู ูู `product` (ููุชุฌ)

---

### 9. payments - ุงููุฏููุนุงุช
ุชูุงุตูู ุงููุฏููุนุงุช

| Column | Type | Description |
|--------|------|-------------|
| id | String (UUID) | ุงููุนุฑู ุงููุฑูุฏ |
| invoice_id | String | ูุนุฑู ุงููุงุชูุฑุฉ |
| payment_method | Enum | ุทุฑููุฉ ุงูุฏูุน |
| amount | Decimal(10,2) | ุงููุจูุบ |
| reference_number | String | ุฑูู ุงููุฑุฌุน (ููุจุทุงูุงุช) |
| notes | Text | ููุงุญุธุงุช |
| created_at | DateTime | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

**ุงูุนูุงูุงุช:**
- ููุชูู ูู `invoice` (ูุงุชูุฑุฉ)

---

### 10. shifts - ุงููุฑุฏูุงุช
ูุฑุฏูุงุช ุงููุงุดูุฑ

| Column | Type | Description |
|--------|------|-------------|
| id | String (UUID) | ุงููุนุฑู ุงููุฑูุฏ |
| user_id | String | ูุนุฑู ุงููุณุชุฎุฏู (ุงููุงุดูุฑ) |
| status | Enum | ุงูุญุงูุฉ (open, closed) |
| opening_balance | Decimal(10,2) | ุฑุตูุฏ ุงูุงูุชุชุงุญ |
| closing_balance | Decimal(10,2) | ุฑุตูุฏ ุงูุฅุบูุงู |
| expected_cash | Decimal(10,2) | ุงูููุฏ ุงููุชููุน |
| actual_cash | Decimal(10,2) | ุงูููุฏ ุงููุนูู |
| difference | Decimal(10,2) | ุงููุฑู |
| notes | Text | ููุงุญุธุงุช |
| opened_at | DateTime | ุชุงุฑูุฎ ุงููุชุญ |
| closed_at | DateTime | ุชุงุฑูุฎ ุงูุฅุบูุงู |

**ุงูุนูุงูุงุช:**
- ููุชูู ูู `user` (ูุณุชุฎุฏู)
- ูู ุนุฏุฉ `invoices` (ููุงุชูุฑ)
- ูู ุนุฏุฉ `cash_movements` (ุญุฑูุงุช ููุฏูุฉ)

---

### 11. cash_register - ุญุฑูุงุช ุงูุตูุฏูู
ุญุฑูุงุช ุงูููุฏ ูู ุงูุตูุฏูู

| Column | Type | Description |
|--------|------|-------------|
| id | String (UUID) | ุงููุนุฑู ุงููุฑูุฏ |
| shift_id | String | ูุนุฑู ุงููุฑุฏูุฉ |
| transaction_type | String | ููุน ุงูุญุฑูุฉ (sale, expense, deposit, withdrawal) |
| amount | Decimal(10,2) | ุงููุจูุบ |
| description | Text | ุงููุตู |
| created_at | DateTime | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

**ุงูุนูุงูุงุช:**
- ููุชูู ูู `shift` (ูุฑุฏูุฉ)

---

### 12. inventory_movements - ุญุฑูุงุช ุงููุฎุฒูู
ุชุชุจุน ุญุฑูุงุช ุงููุฎุฒูู

| Column | Type | Description |
|--------|------|-------------|
| id | String (UUID) | ุงููุนุฑู ุงููุฑูุฏ |
| product_id | String | ูุนุฑู ุงูููุชุฌ |
| movement_type | String | ููุน ุงูุญุฑูุฉ (purchase, sale, adjustment, damage) |
| quantity | Decimal(10,3) | ุงููููุฉ (+/-) |
| previous_quantity | Decimal(10,3) | ุงููููุฉ ุงูุณุงุจูุฉ |
| new_quantity | Decimal(10,3) | ุงููููุฉ ุงูุฌุฏูุฏุฉ |
| notes | Text | ููุงุญุธุงุช |
| created_at | DateTime | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

**ุงูุนูุงูุงุช:**
- ููุชูู ูู `product` (ููุชุฌ)

**ูุคุดุฑุงุช:**
- `product_id`
- `created_at`

---

### 13. offers - ุงูุนุฑูุถ
ุนุฑูุถ ูุฎุตููุงุช

| Column | Type | Description |
|--------|------|-------------|
| id | String (UUID) | ุงููุนุฑู ุงููุฑูุฏ |
| name | String | ุงุณู ุงูุนุฑุถ |
| description | Text | ุงููุตู |
| discount_type | String | ููุน ุงูุฎุตู (percentage, fixed) |
| discount_value | Decimal(10,2) | ูููุฉ ุงูุฎุตู |
| min_quantity | Integer | ุงูุญุฏ ุงูุฃุฏูู ูููููุฉ |
| start_date | DateTime | ุชุงุฑูุฎ ุงูุจุฏุงูุฉ |
| end_date | DateTime | ุชุงุฑูุฎ ุงูููุงูุฉ |
| is_active | Boolean | ูุดุทุ |
| created_at | DateTime | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

---

### 14. audit_logs - ุณุฌู ุงูุชุฏููู
ุชุณุฌูู ุฌููุน ุงูุนูููุงุช

| Column | Type | Description |
|--------|------|-------------|
| id | String (UUID) | ุงููุนุฑู ุงููุฑูุฏ |
| user_id | String | ูุนุฑู ุงููุณุชุฎุฏู |
| action | String | ุงูุฅุฌุฑุงุก (create, update, delete, login, logout) |
| entity_type | String | ููุน ุงูููุงู (product, invoice, user, etc) |
| entity_id | String | ูุนุฑู ุงูููุงู |
| details | Text | ุงูุชูุงุตูู (JSON) |
| ip_address | String | ุนููุงู IP |
| created_at | DateTime | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

**ุงูุนูุงูุงุช:**
- ููุชูู ูู `user` (ูุณุชุฎุฏู)

**ูุคุดุฑุงุช:**
- `user_id`
- `created_at`
- `entity_type`

---

## ๐ ูุฎุทุท ุงูุนูุงูุงุช (ERD)

```
โโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ
โ   users     โโโโโโโโโโโค   invoices   โ
โโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ
       โ                       โ
       โ                       โ
       โผ                       โผ
โโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ
โ   shifts    โ         โinvoice_items โ
โโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ
       โ                       โ
       โ                       โ
       โผ                       โผ
โโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ
โcash_registerโ         โ   products   โ
โโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ
                               โ
                               โผ
                        โโโโโโโโโโโโโโโโ
                        โ  categories  โ
                        โโโโโโโโโโโโโโโโ
```

---

## ๐ ุญุฌู ุงูุจูุงูุงุช ุงููุชููุน

### ุณูุจุฑ ูุงุฑูุช ุตุบูุฑ (100 ููุชุฌ):
- Products: ~100 ุตู
- Invoices: ~50-100 ููููุงู (1,500-3,000 ุดูุฑูุงู)
- Invoice Items: ~150-300 ููููุงู
- Users: 5-10
- Customers: 200-500

### ุณูุจุฑ ูุงุฑูุช ูุชูุณุท (1000 ููุชุฌ):
- Products: ~1,000 ุตู
- Invoices: ~200-500 ููููุงู (6,000-15,000 ุดูุฑูุงู)
- Invoice Items: ~600-1,500 ููููุงู
- Users: 10-20
- Customers: 1,000-5,000

### ุณูุจุฑ ูุงุฑูุช ูุจูุฑ (5000+ ููุชุฌ):
- Products: ~5,000-10,000 ุตู
- Invoices: ~1,000+ ููููุงู (30,000+ ุดูุฑูุงู)
- Invoice Items: ~3,000+ ููููุงู
- Users: 20-50
- Customers: 5,000-20,000

---

## ๐ ุงูุฃูุงู

### ุญูุงูุฉ ุงูุจูุงูุงุช:
1. **Passwords**: ูุดูุฑุฉ ุจุงุณุชุฎุฏุงู bcrypt
2. **JWT Tokens**: ูููุตุงุฏูุฉ
3. **SQL Injection**: ูุญูู ุนุจุฑ SQLAlchemy ORM
4. **Audit Logs**: ุชุณุฌูู ุฌููุน ุงูุนูููุงุช ุงูุญุณุงุณุฉ

### ุงููุณุฎ ุงูุงุญุชูุงุทู:
```bash
# ูููู
pg_dump supermarket_db > backup_$(date +%Y%m%d).sql

# ุฃุณุจูุนู (ูุงูู)
pg_dumpall > full_backup_$(date +%Y%m%d).sql
```

---

## ๐ ุงูุชุญุณููุงุช ูุงููุคุดุฑุงุช

### ูุคุดุฑุงุช ููุตู ุจูุง:
```sql
-- Products
CREATE INDEX idx_products_barcode ON products(barcode);
CREATE INDEX idx_products_name ON products(name);
CREATE INDEX idx_products_category ON products(category_id);

-- Invoices
CREATE INDEX idx_invoices_date ON invoices(created_at);
CREATE INDEX idx_invoices_user ON invoices(user_id);
CREATE INDEX idx_invoices_customer ON invoices(customer_id);
CREATE INDEX idx_invoices_number ON invoices(invoice_number);

-- Inventory Movements
CREATE INDEX idx_inventory_product ON inventory_movements(product_id);
CREATE INDEX idx_inventory_date ON inventory_movements(created_at);

-- Audit Logs
CREATE INDEX idx_audit_user ON audit_logs(user_id);
CREATE INDEX idx_audit_date ON audit_logs(created_at);
CREATE INDEX idx_audit_entity ON audit_logs(entity_type, entity_id);
```

---

## ๐ง ุงูุตูุงูุฉ

### ุชูุธูู ุฏูุฑู:
```sql
-- ุญุฐู ุณุฌูุงุช ุงูุชุฏููู ุงููุฏููุฉ (ุฃูุซุฑ ูู ุณูุฉ)
DELETE FROM audit_logs WHERE created_at < NOW() - INTERVAL '1 year';

-- ุชูุธูู ุงูุฌุฏุงูู
VACUUM ANALYZE;

-- ุฅุนุงุฏุฉ ุจูุงุก ุงููุคุดุฑุงุช
REINDEX DATABASE supermarket_db;
```

### ุงูุชุญูู ูู ุงูุฃุฏุงุก:
```sql
-- ุฃุจุทุฃ ุงูุงุณุชุนูุงูุงุช
SELECT query, calls, total_time, mean_time 
FROM pg_stat_statements 
ORDER BY mean_time DESC 
LIMIT 10;

-- ุญุฌู ุงูุฌุฏุงูู
SELECT 
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size
FROM pg_tables
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **UUID vs Auto-increment**: ุงุณุชุฎุฏููุง UUID ูููุนุฑูุงุช ูุชุฌูุจ ุงูุชุนุงุฑุถุงุช ูู ุญุงูุฉ ุฏูุฌ ุงูุจูุงูุงุช ูู ุนุฏุฉ ูุฑูุน

2. **Decimal vs Float**: ุงุณุชุฎุฏููุง Decimal ููุฃููุงู ูุชุฌูุจ ุฃุฎุทุงุก ุงูุชูุฑูุจ

3. **Soft Delete**: ุจุนุถ ุงูุฌุฏุงูู ุชุณุชุฎุฏู `is_active` ุจุฏูุงู ูู ุงูุญุฐู ุงููุนูู

4. **Timestamps**: ุฌููุน ุงูุฌุฏุงูู ุชุญุชูู ุนูู `created_at` ุนูู ุงูุฃูู

5. **Indexing**: ุงููุคุดุฑุงุช ูููุฉ ุฌุฏุงู ููุฃุฏุงุกุ ุฎุงุตุฉ ุนูู ุงูุฃุนูุฏุฉ ุงููุณุชุฎุฏูุฉ ูู ุงูุจุญุซ

---

## ๐ ุงูุชุฑููุงุช ุงููุณุชูุจููุฉ

### ูุงุนุฏุฉ ุจูุงูุงุช:
- [ ] ุฌุฏูู `branches` (ูุฑูุน ูุชุนุฏุฏุฉ)
- [ ] ุฌุฏูู `promotions` (ุชุฑููุฌ ูุชูุฏู)
- [ ] ุฌุฏูู `purchase_orders` (ุทูุจุงุช ุดุฑุงุก)
- [ ] ุฌุฏูู `stock_takes` (ุฌุฑุฏ)
- [ ] ุฌุฏูู `returns` (ูุฑุชุฌุนุงุช ูููุตูุฉ)

### ุชุญุณููุงุช ุงูุฃุฏุงุก:
- [ ] Partitioning ููุฌุฏุงูู ุงููุจูุฑุฉ (invoices, invoice_items)
- [ ] Read Replicas ููุชูุงุฑูุฑ
- [ ] Caching Layer (Redis)

---

**ุชู ุงูุชุตููู ุจุนูุงูุฉ ูุถูุงู ุงูุฃุฏุงุก ูุงููุฑููุฉ ูุงููุงุจููุฉ ููุชุทููุฑ ๐ฏ**
"